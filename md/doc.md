# –ü–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: Telegram –±–æ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–í–≤–µ–¥–µ–Ω–∏–µ –∏ –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#1-–≤–≤–µ–¥–µ–Ω–∏–µ-–∏-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#2-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)
3. [–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –º–æ–¥—É–ª–µ–π](#3-–¥–µ—Ç–∞–ª—å–Ω—ã–π-—Ä–∞–∑–±–æ—Ä-–º–æ–¥—É–ª–µ–π)
4. [–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM](#4-—Å–∏—Å—Ç–µ–º–∞-—Å–æ—Å—Ç–æ—è–Ω–∏–π-fsm)
5. [–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ callback-–æ–≤](#5-–æ–±—Ä–∞–±–æ—Ç–∫–∞-—Å–æ–æ–±—â–µ–Ω–∏–π-–∏-callback-–æ–≤)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏](#6-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–¥–∞–Ω–Ω—ã–º–∏)
7. [–°–∏—Å—Ç–µ–º–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä](#7-—Å–∏—Å—Ç–µ–º–∞-–∫–ª–∞–≤–∏–∞—Ç—É—Ä)
8. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫](#8-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∏-–∑–∞–ø—É—Å–∫)
---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### 1.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏ –∑–∞–¥–∞—á —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** —Å–ø–∏—Å–∫–æ–≤ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥
- **–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ** –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
- **–ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### 1.2 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Python 3.8+   ‚îÇ    ‚îÇ   Aiogram 3.x   ‚îÇ    ‚îÇ   Asyncio       ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ Type hints    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ FSM support   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ Async/await   ‚îÇ
‚îÇ ‚Ä¢ Dataclasses   ‚îÇ    ‚îÇ ‚Ä¢ Router system ‚îÇ    ‚îÇ ‚Ä¢ Event loop    ‚îÇ
‚îÇ ‚Ä¢ Logging       ‚îÇ    ‚îÇ ‚Ä¢ Middleware    ‚îÇ    ‚îÇ ‚Ä¢ Tasks         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                        ‚îÇ                        ‚îÇ
         ‚ñº                        ‚ñº                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Memory        ‚îÇ    ‚îÇ   Telegram      ‚îÇ    ‚îÇ   Standard      ‚îÇ
‚îÇ   Storage       ‚îÇ    ‚îÇ   Bot API       ‚îÇ    ‚îÇ   Library       ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ Dict-based    ‚îÇ    ‚îÇ ‚Ä¢ Long polling  ‚îÇ    ‚îÇ ‚Ä¢ Collections   ‚îÇ
‚îÇ ‚Ä¢ Session data  ‚îÇ    ‚îÇ ‚Ä¢ Webhooks      ‚îÇ    ‚îÇ ‚Ä¢ Datetime      ‚îÇ
‚îÇ ‚Ä¢ State mgmt    ‚îÇ    ‚îÇ ‚Ä¢ File upload   ‚îÇ    ‚îÇ ‚Ä¢ Random        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- **Router Pattern** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- **State Pattern** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ —á–µ—Ä–µ–∑ FSM
- **Callback Pattern** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ inline-–∫–Ω–æ–ø–æ–∫
- **Singleton Pattern** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 2.1 –û–±—â–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
```mermaid
graph TB
    USER[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|–°–æ–æ–±—â–µ–Ω–∏–µ| BOT[Telegram Bot]
    BOT -->|Update| DP[Dispatcher]
    DP -->|Routing| ROUTER[Message Router]
    ROUTER -->|Command| HANDLER[Message Handler]
    ROUTER -->|Callback| CB_HANDLER[Callback Handler]
    ROUTER -->|State| STATE_HANDLER[State Handler]
    
    HANDLER -->|Read/Write| MEM_STORE[Memory Storage]
    CB_HANDLER -->|Read/Write| MEM_STORE
    STATE_HANDLER -->|State mgmt| FSM[FSM Context]
    
    MEM_STORE -->|Logging| CONSOLE[Console Output]
    FSM -->|State transitions| STATE_DEF[State Definitions]
    
    subgraph "Data Storage"
        MEM_STORE
        STATE_DEF
    end
    
    subgraph "Business Logic"
        HANDLER
        CB_HANDLER
        STATE_HANDLER
    end
```

### 2.2 –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ/–∫–æ–º–∞–Ω–¥—É
2. Telegram —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–¥–∞–µ—Ç update –±–æ—Ç—É
3. Dispatcher –ø–æ–ª—É—á–∞–µ—Ç update –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø
4. Router –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
5. Handler –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
6. Handler –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
7. Handler –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
8. –°–æ—Å—Ç–æ—è–Ω–∏–µ FSM –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

### 2.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–¥–µ—Ç–∞–ª—å–Ω–∞—è)
```
app/src/bot/
‚îú‚îÄ‚îÄ üìÅ core/                    # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py          # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üìÅ handlers/               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ start.py              # –ö–æ–º–∞–Ω–¥–∞ /start
‚îÇ   ‚îú‚îÄ‚îÄ tasker.py             # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ states_handler/    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
‚îÇ       ‚îî‚îÄ‚îÄ statess.py        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM
‚îú‚îÄ‚îÄ üìÅ keyboards/             # –°–∏—Å—Ç–µ–º–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ keyboard_handler.py   # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îú‚îÄ‚îÄ üìÅ middleware/            # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
‚îÇ   ‚îî‚îÄ‚îÄ logging.py            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ üìÅ models/                # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ task_models.py        # –ú–æ–¥–µ–ª–∏ –∑–∞–¥–∞—á (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ üìÅ services/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ task_service.py       # –°–µ—Ä–≤–∏—Å –∑–∞–¥–∞—á (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ üìÅ storage/               # –•—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ memory_storage.py     # –¢–µ–∫—É—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –ø–∞–º—è—Ç–∏
‚îú‚îÄ‚îÄ main.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config_bot.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å
‚îî‚îÄ‚îÄ setup_bot.py             # –£—Ç–∏–ª–∏—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

---

## 3. –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –º–æ–¥—É–ª–µ–π

### 3.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (`main.py`)

```python
import asyncio
import logging
from aiogram import Bot, Dispatcher
from aiogram.fsm.storage.memory import MemoryStorage
from app.src.bot.handlers import router

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

API_TOKEN = ''

async def main():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
    """
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
    bot = Bot(token=API_TOKEN)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –≤ –ø–∞–º—è—Ç–∏
    dp = Dispatcher(storage=MemoryStorage())
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    dp.include_router(router)
    
    # –û—á–∏—Å—Ç–∫–∞ –≤–µ–±—Ö—É–∫–∞ –∏ –Ω–∞—á–∞–ª–æ –æ–ø—Ä–æ—Å–∞
    await bot.delete_webhook(drop_pending_updates=True)
    
    # –ó–∞–ø—É—Å–∫ long-polling
    await dp.start_polling(bot)

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    asyncio.run(main())
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
- –¢–æ–∫–µ–Ω —Ö–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–¥–µ (–Ω–∞—Ä—É—à–µ–Ω–∏–µ security best practices)
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ù–µ—Ç graceful shutdown

### 3.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å (`config_bot.py`)

```python
import os
import sys
from typing import Optional

class SimpleConfig:
    """
    –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    """
    
    def __init__(self):
        self.bot_token = self._get_bot_token()
        self._validate_token()
    
    def _get_bot_token(self) -> str:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:
        1. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è BOT_TOKEN
        2. –§–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
        3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π
        """
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
        token = os.getenv('BOT_TOKEN')
        if token:
            return self._sanitize_token(token)
        
        # –ß—Ç–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞ .env
        token = self._read_token_from_env_file()
        if token:
            return self._sanitize_token(token)
        
        # –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω
        self._print_token_error()
        sys.exit(1)
    
    def _read_token_from_env_file(self) -> Optional[str]:
        """
        –ß—Ç–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ .env
        """
        try:
            with open('.env', 'r', encoding='utf-8') as f:
                for line in f:
                    line = line.strip()
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                    if line and not line.startswith('#') and '=' in line:
                        key, value = line.split('=', 1)
                        if key.strip() == 'BOT_TOKEN':
                            return value.strip()
        except FileNotFoundError:
            return None
        return None
    
    def _sanitize_token(self, token: str) -> str:
        """
        –û—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
        """
        return token.strip('"').strip("'").strip()
    
    def _validate_token(self):
        """
        –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞
        """
        if not self.bot_token.startswith('') or ':' not in self.bot_token:
            print(f"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞: {self.bot_token[:20]}...")
            sys.exit(1)
    
    def _print_token_error(self):
        """
        –í—ã–≤–æ–¥ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–∫–µ–Ω–∞
        """
        print("‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("\nüìù –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:")
        print("BOT_TOKEN=your_actual_bot_token_here")
        print("\nüîß –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:")
        print("Windows: set BOT_TOKEN=your_token")
        print("Linux/Mac: export BOT_TOKEN=your_token")
    
    def get_secret_value(self) -> str:
        """
        –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
        """
        return self.bot_token

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
try:
    config = SimpleConfig()
    print(f"‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –¢–æ–∫–µ–Ω: {config.bot_token[:10]}...")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
    config = None
```

### 3.3 –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–¥–∞—á (`tasker.py`)

#### 3.3.1 –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

```python
# –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–ø–∏—Å–∫–æ–≤ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {user_id: {'tasks': List[str], 'created_at': str}}
user_task_lists = {}

# –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {user_id: {'action': str, 'task_index': int, 'old_task': str}}
user_edit_data = {}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞
router = Router()
```

#### 3.3.2 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞:**
```python
@router.message(F.text == '/add_tasks_list')
async def start_task_list(message: Message, state: FSMContext):
    user_id = message.from_user.id
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞
    user_task_lists[user_id] = {
        'tasks': [],
        'created_at': datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
    await message.answer(
        "üìù –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á!\n\n"
        "–í–≤–æ–¥–∏—Ç–µ –∑–∞–¥–∞—á–∏ –ø–æ –æ–¥–Ω–æ–π. –ö–∞–∂–¥–æ–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞.\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –∏–ª–∏ inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–º:",
        reply_markup=tasks_keyboard
    )
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
    await message.answer(
        "‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:",
        reply_markup=get_tasks_inline_keyboard()
    )
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á
    await state.set_state(TaskListForm.adding_tasks)
```

**–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ inline-–∫–Ω–æ–ø–æ–∫:**
```python
@router.callback_query(F.data.in_([
    "finish_list", "clear_list", "show_list", "edit_list", 
    "delete_list", "back_to_main", "add_task", "remove_task", 
    "rename_task", "shuffle_tasks", "cancel_action", "back_to_edit"
]))
async def handle_inline_buttons(callback: CallbackQuery, state: FSMContext):
    """
    –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ inline-–∫–Ω–æ–ø–æ–∫
    –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é callback.data
    """
    user_id = callback.from_user.id
    action = callback.data
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è callback
    await callback.answer()
    
    # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π
    action_handlers = {
        "finish_list": finish_task_list_inline,
        "clear_list": clear_task_list_inline,
        "show_list": show_current_list_inline,
        "edit_list": edit_list_inline,
        "delete_list": delete_list_inline,
        "back_to_main": back_to_main_inline,
        "add_task": add_task_inline,
        "remove_task": remove_task_inline,
        "rename_task": rename_task_inline,
        "shuffle_tasks": shuffle_tasks_inline,
        "cancel_action": cancel_action_inline,
        "back_to_edit": edit_list_inline
    }
    
    handler = action_handlers.get(action)
    if handler:
        await handler(callback, state)
```

#### 3.3.3 –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á

```python
@router.message(TaskListForm.adding_tasks)
async def add_task_to_list(message: Message, state: FSMContext):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ adding_tasks
    –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ–π
    """
    user_id = message.from_user.id
    
    # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∫–Ω–æ–ø–æ–∫ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
    button_commands = [
        "‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–ø–∏—Å–æ–∫", "üìã –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫", 
        "üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫", "‚ùå –û—Ç–º–µ–Ω–∞"
    ]
    if message.text in button_commands:
        return
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ —Å–ø–∏—Å–æ–∫
    task_text = message.text.strip()
    
    if user_id in user_task_lists:
        user_task_lists[user_id]['tasks'].append(task_text)
        current_count = len(user_task_lists[user_id]['tasks'])
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
        print(f"‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ #{current_count}: '{task_text}' - {message.from_user.full_name}")
        
        # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        await message.answer(
            f"‚úÖ –ó–∞–¥–∞—á–∞ #{current_count} –¥–æ–±–∞–≤–ª–µ–Ω–∞!\n\n"
            f"–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∑–∞–¥–∞—á–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
            reply_markup=get_tasks_inline_keyboard()
        )
```

---

## 4. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM

### 4.1 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π (`statess.py`)

```python
from aiogram.fsm.state import State, StatesGroup

class TaskListForm(StatesGroup):
    """
    –ì—Ä—É–ø–ø–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –∑–∞–¥–∞—á
    """
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á
    adding_tasks = State()
    """
    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞
    –í—ã—Ö–æ–¥ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞
    """
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–ø–∏—Å–∫–∞
    waiting_for_tasks = State()
    """
    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–∂–∏–¥–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —Å –∑–∞–¥–∞—á–∞–º–∏
    –û–±—Ä–∞–±–æ—Ç–∫–∞: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–µ—Ä–µ–Ω–æ—Å–∞–º —Å—Ç—Ä–æ–∫ –∏–ª–∏ –∑–∞–ø—è—Ç—ã–º
    –í—ã—Ö–æ–¥: –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    """
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏
    editing_task = State()
    """
    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–∂–∏–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏
    –ö–æ–Ω—Ç–µ–∫—Å—Ç: –ò–Ω–¥–µ–∫—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–¥–∞—á–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ user_edit_data
    –í—ã—Ö–æ–¥: –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ –æ—Ç–º–µ–Ω—ã
    """
```

### 4.2 –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```mermaid
stateDiagram-v2
    [*] --> IDLE : –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω
    
    IDLE --> ADDING_TASKS : /add_tasks_list
    IDLE --> WAITING_TASKS : /quick_tasks
    
    ADDING_TASKS --> ADDING_TASKS : –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
    ADDING_TASKS --> EDITING_TASK : –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
    ADDING_TASKS --> IDLE : –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–û—Ç–º–µ–Ω–∞
    
    WAITING_TASKS --> IDLE : –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∫–∞
    
    EDITING_TASK --> ADDING_TASKS : –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    EDITING_TASK --> ADDING_TASKS : –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    
    note right of ADDING_TASKS
        –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - 
        –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
        –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã
    end note
    
    note left of WAITING_TASKS
        –û–∂–∏–¥–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ
        –≤–≤–æ–¥–∞ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
        –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏–ª–∏ –∑–∞–ø—è—Ç—ã–µ
    end note
```

### 4.3 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –≤ –∫–æ–¥–µ

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```python
await state.set_state(TaskListForm.adding_tasks)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ:**
```python
@router.message(TaskListForm.adding_tasks)
async def state_specific_handler(message: Message, state: FSMContext):
    # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ adding_tasks
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```python
current_state = await state.get_state()
```

**–û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```python
await state.clear()
```

---

## 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ callback-–æ–≤

### 5.1 –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ Aiogram

```python
# –§–∏–ª—å—Ç—Ä –ø–æ —Ç–æ—á–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
F.text == '/start'

# –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞—á–∞–ª—É —Ç–µ–∫—Å—Ç–∞
F.text.startswith('/')

# –§–∏–ª—å—Ç—Ä –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é
TaskListForm.adding_tasks

# –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
F.content_type.in_({'text', 'photo'})

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
F.text & F.from_user.id == 123456
```

### 5.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ callback-–¥–∞–Ω–Ω—ã—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ callback data:**
```
action_target[_index]
‚îú‚îÄ‚îÄ action: –±–∞–∑–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (finish, clear, show, edit)
‚îú‚îÄ‚îÄ target: –æ–±—ä–µ–∫—Ç –¥–µ–π—Å—Ç–≤–∏—è (list, task)
‚îî‚îÄ‚îÄ index: –∏–Ω–¥–µ–∫—Å —ç–ª–µ–º–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü—Ä–∏–º–µ—Ä—ã:
"finish_list"          - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
"select_remove_2"      - –≤—ã–±–æ—Ä –∑–∞–¥–∞—á–∏ ‚Ññ2 –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è  
"confirm_remove_2"     - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ ‚Ññ2
"select_rename_0"      - –≤—ã–±–æ—Ä –∑–∞–¥–∞—á–∏ ‚Ññ0 –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
```

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:**
```python
@router.callback_query(F.data.startswith(("select_rename_", "select_remove_", "confirm_remove_")))
async def handle_task_selection(callback: CallbackQuery, state: FSMContext):
    user_id = callback.from_user.id
    data_parts = callback.data.split('_')
    action_type = data_parts[0]  # "select" –∏–ª–∏ "confirm"
    action_name = data_parts[1]  # "rename" –∏–ª–∏ "remove"
    
    await callback.answer()
    
    if action_type == "select":
        task_index = int(data_parts[2])
        if action_name == "rename":
            await handle_select_rename_task(callback, task_index, state)
        elif action_name == "remove":
            await handle_select_remove_task(callback, task_index)
    
    elif action_type == "confirm" and action_name == "remove":
        task_index = int(data_parts[2])
        await handle_confirm_remove_task(callback, task_index)
```

---

## 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏

### 6.1 –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ user_task_lists:**
```python
user_task_lists = {
    123456789: {
        'tasks': [
            '–ö—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã',
            '–°–¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É', 
            '–ü–æ–∑–≤–æ–Ω–∏—Ç—å –º–∞–º–µ'
        ],
        'created_at': '2024-01-15 14:30:00'
    },
    987654321: {
        'tasks': [
            '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç—á–µ—Ç',
            '–í—Å—Ç—Ä–µ—á–∞ —Å –∫–æ–º–∞–Ω–¥–æ–π'
        ],
        'created_at': '2024-01-15 15:45:00'
    }
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ user_edit_data:**
```python
user_edit_data = {
    123456789: {
        'action': 'renaming',           # –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
        'task_index': 1,                # –ò–Ω–¥–µ–∫—Å –∑–∞–¥–∞—á–∏ –≤ —Å–ø–∏—Å–∫–µ
        'old_task': '–°–¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à—É —Ä–∞–±–æ—Ç—É'  # –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç
    }
}
```

### 6.2 –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏:**
```python
def add_task(user_id: int, task_text: str) -> bool:
    if user_id not in user_task_lists:
        return False
    
    user_task_lists[user_id]['tasks'].append(task_text)
    return True
```

**–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏:**
```python
def remove_task(user_id: int, task_index: int) -> Optional[str]:
    if (user_id not in user_task_lists or 
        task_index < 0 or 
        task_index >= len(user_task_lists[user_id]['tasks'])):
        return None
    
    return user_task_lists[user_id]['tasks'].pop(task_index)
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á:**
```python
def get_user_tasks(user_id: int) -> List[str]:
    if user_id not in user_task_lists:
        return []
    return user_task_lists[user_id]['tasks'].copy()
```

---

## 7. –°–∏—Å—Ç–µ–º–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä

### 7.1 –¢–∏–ø—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä

**InlineKeyboardMarkup** - –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
```python
inline_kb = InlineKeyboardMarkup(
    inline_keyboard=[
        [InlineKeyboardButton(text="–¢–µ–∫—Å—Ç", callback_data="action")],
        [InlineKeyboardButton(text="URL", url="https://example.com")]
    ]
)
```

**ReplyKeyboardMarkup** - –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞:
```python
reply_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="–ö–æ–º–∞–Ω–¥–∞ 1")],
        [KeyboardButton(text="–ö–æ–º–∞–Ω–¥–∞ 2")]
    ],
    resize_keyboard=True,
    one_time_keyboard=False
)
```

### 7.2 –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä (`keyboard_handler.py`)

**–û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
def get_tasks_inline_keyboard():
    """
    –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞–¥–∞—á
    """
    return InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å", callback_data="finish_list"),
                InlineKeyboardButton(text="üîÑ –û—á–∏—Å—Ç–∏—Ç—å", callback_data="clear_list")
            ],
            [
                InlineKeyboardButton(text="üìã –ü–æ–∫–∞–∑–∞—Ç—å", callback_data="show_list"),
                InlineKeyboardButton(text="‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", callback_data="edit_list")
            ],
            [
                InlineKeyboardButton(text="‚ùå –£–¥–∞–ª–∏—Ç—å", callback_data="delete_list")
            ]
        ]
    )
```

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ –∑–∞–¥–∞—á:**
```python
def get_tasks_selection_keyboard(tasks: List[str], action: str) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏
    """
    keyboard = []
    
    for i, task in enumerate(tasks, 1):
        # –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ
        display_text = task[:30] + ('...' if len(task) > 30 else '')
        callback_data = f"{action}_{i-1}"  # "select_remove_0", "select_rename_1"
        
        keyboard.append([
            InlineKeyboardButton(text=f"{i}. {display_text}", callback_data=callback_data)
        ])
    
    # –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
    keyboard.append([
        InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_edit")
    ])
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)
```

---

## 8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫

### 8.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**requirements.txt:**
```txt
aiogram==3.8.1
python-dotenv==1.0.0
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Linux/Mac)
source venv/bin/activate

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Windows)
venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### 8.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É
python setup_bot.py

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
echo "BOT_TOKEN=your_actual_bot_token_here" > .env
```

### 8.3 –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
python main.py

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
python -u main.py

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (Linux/Mac)
nohup python main.py > bot.log 2>&1 &
```

---